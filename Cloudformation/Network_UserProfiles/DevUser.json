{
  "AWSTemplateFormatVersion" : "2010-09-09",

  "Description" : "CloudFormation script creates user along with policies: 1.It creates Devloper user 2.It creates Managed Policy and gets attached to Devloper user 3. It also creates Inline policy and gets attached to Devloper user.",

  "Parameters" : {
   "DevUserName": {
      "Type": "String",
      "Description" : "Developer User Name"
    },
    "Password": {
      "NoEcho": "true",
      "Type": "String",
      "Description" : "User password",
      "MinLength": "1",
      "MaxLength": "41"
    }  
	},

  "Resources" : {
    "DevUser" : {
      "Type" : "AWS::IAM::User",
      "Properties" : {
        "LoginProfile": {
          "Password": { "Ref" : "Password" }
        },
		"UserName": {"Ref" : "DevUserName"}
      }
    },

    "AddUserToPowerUserGroup" : {
      "Type" : "AWS::IAM::UserToGroupAddition",
      "Properties" : {
        "GroupName": { "Fn::ImportValue" : "DevGroup"},
        "Users" : [ { "Ref" : "DevUser" } ]
      }
    },

    "DevPolicies" : {
      "Type" : "AWS::IAM::Policy",
      "Properties" : {
        "PolicyName" : "DevUserInlinePolicy",
        "PolicyDocument" : {
          "Statement": [{
            "Effect"   : "Allow",
            "Action"   : [
              "cloudformation:Describe*",
              "cloudformation:List*",
              "cloudformation:Get*"
              ],
            "Resource" : "*"
          }]
        },
        "Users" : [{"Ref" : "DevUser"}]
      }
    },
	"CreateTestPolicy" : {
	  "Type" : "AWS::IAM::ManagedPolicy",
	  "Properties" : {
		"Description" : "managed policy for Developer User",
		"Path" : "/",
		"Users" : [{"Ref" : "DevUser"}],
		"PolicyDocument" :   {
		  "Version":"2012-10-17", 
		  "Statement" : {
			"Effect" : "Allow",           
			"Action" : "rds:CreateDBInstance",
			"Resource" : {"Fn::Join" : [ "", [ "arn:aws:rds:", { "Ref" : "AWS::Region" }, ":", { "Ref" : "AWS::AccountId" }, ":db:test*" ] ]}, 
			"Condition" : {
			  "StringEquals" : { "rds:DatabaseEngine" : "mysql" }
			}
		  }
		}
	  }
	}
  }
}