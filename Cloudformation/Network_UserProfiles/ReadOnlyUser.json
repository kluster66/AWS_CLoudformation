{
  "AWSTemplateFormatVersion" : "2010-09-09",

  "Description" : "CloudFormation script creates user along with policies: 1.It creates ReadOnly user 2.It creates Managed Policy and gets attached to ReadOnly User 3. It also creates Inline policy and gets attached to ReadOnly User.",

  "Parameters" : {
   "ReadOnlyUserName": {
      "Type": "String",
      "Description" : "ReadOnly User Name"
    },
    "Password": {
      "NoEcho": "true",
      "Type": "String",
      "Description" : "User password",
      "MinLength": "1",
      "MaxLength": "41"
    }  
	},

  "Resources" : {
    "ReadOnlyUser" : {
      "Type" : "AWS::IAM::User",
      "Properties" : {
        "LoginProfile": {
          "Password": { "Ref" : "Password" }
        },
		"UserName": {"Ref" : "ReadOnlyUserName"}
      }
    },

    "AddUserToPowerUserGroup" : {
      "Type" : "AWS::IAM::UserToGroupAddition",
      "Properties" : {
        "GroupName": { "Fn::ImportValue" : "ReadOnlyGroup"},
        "Users" : [ { "Ref" : "ReadOnlyUser" } ]
      }
    },

    "DevPolicies" : {
      "Type" : "AWS::IAM::Policy",
      "Properties" : {
        "PolicyName" : "ReadOnlyUserInlinePolicy",
        "PolicyDocument" : {
          "Statement": [{
            "Effect"   : "Allow",
            "Action"   : [
              "cloudformation:Describe*",
              "cloudformation:List*"
              ],
            "Resource" : "*"
          }]
        },
        "Users" : [{"Ref" : "ReadOnlyUser"}]
      }
    },
	"CreateTestPolicy" : {
	  "Type" : "AWS::IAM::ManagedPolicy",
	  "Properties" : {
		"Description" : "managed policy for ReadOnly User",
		"Path" : "/",
		"Users" : [{"Ref" : "ReadOnlyUser"}],
		"PolicyDocument" :   {
		  "Version":"2012-10-17", 
		  "Statement" : {
			"Effect" : "Allow",           
			"Action" : [
              "cloudformation:DescribeStacks",
              "cloudformation:DescribeStackEvents",
              "cloudformation:DescribeStackResource",
              "cloudformation:DescribeStackResources",
              "cloudformation:GetTemplate",
              "cloudformation:List*"
              ],
			"Resource" : "*"
		  }
		}
	  }
	}
  }
}